<!DOCTYPE html>
<html>
<head>
    <title>HttpDataSource usage sample</title>
	<meta charset="utf-8" />
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div style="margin: 0; padding: 5px 0px 0px 25px; height: 20px">
        <select id="assetpair"></select>
        <select id="timeinterval">
            <option value="sec">Sec</option>
            <option value="min" selected="selected">1 min</option>
            <!--<option value="min5">5 min</option>
            <option value="min15">15 min</option>
            <option value="min30">30 min</option>-->
            <option value="hour">1 hour</option>
            <!--<option value="hour4">4 hours</option>
            <option value="hour6">6 hours</option>
            <option value="hour12">12 hours</option>-->
            <option value="day">Day</option>
            <!--<option value="week">Week</option>-->
            <option value="month">Month</option>
        </select>
    </div>

    <div style="margin-top: 0px; margin-left: 25px;">
        <div id="chart-container" style="float: left">
        </div>
        <div style="clear: both"></div>
    </div>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../dist/bundle.js?v=6"></script>

    <script type="text/javascript">
       var sampleData = [
            { date: new Date('2017-02-22T10:10:00.000Z'), c: 60.1636, o: 60.0788, h: 60.2795, l: 59.8283 },
            { date: new Date('2017-02-22T10:11:00.000Z'), c: 60.0788, o: 60.1636, h: 62.0860, l: 59.6046 },
            { date: new Date('2017-02-22T10:12:00.000Z'), c: 59.6046, o: 59.4481, h: 59.7453, l: 59.1128 },
            { date: new Date('2017-02-22T10:13:00.000Z'), c: 59.4481, o: 60.4653, h: 60.4653, l: 59.2225 },
            { date: new Date('2017-02-22T10:14:00.000Z'), c: 60.4653, o: 60.9133, h: 61.1961, l: 60.2538 },
            { date: new Date('2017-02-22T10:15:00.000Z'), c: 60.9133, o: 61.2730, h: 61.2864, l: 60.3812 },
            { date: new Date('2017-02-22T10:16:00.000Z'), c: 61.2730, o: 60.4138, h: 61.6339, l: 60.4122 },
            { date: new Date('2017-02-22T10:17:00.000Z'), c: 60.4138, o: 60.3297, h: 60.7954, l: 60.1234 },
            { date: new Date('2017-02-22T10:18:00.000Z'), c: 60.3297, o: 60.6708, h: 60.7392, l: 60.1193 },
            { date: new Date('2017-02-22T10:19:00.000Z'), c: 60.6708, o: 60.9777, h: 60.9777, l: 60.5989 },
            { date: new Date('2017-02-22T10:20:00.000Z'), c: 60.9777, o: 61.0564, h: 61.0730, l: 60.7822 },
            { date: new Date('2017-02-22T10:21:00.000Z'), c: 61.0564, o: 60.9426, h: 61.3663, l: 60.7854 },
            { date: new Date('2017-02-22T10:22:00.000Z'), c: 60.9426, o: 61.1500, h: 61.1675, l: 60.7031 },
            { date: new Date('2017-02-22T10:23:00.000Z'), c: 61.1500, o: 61.4518, h: 61.4598, l: 60.8764 },
            { date: new Date('2017-02-22T10:24:00.000Z'), c: 61.4518, o: 61.9306, h: 62.0000, l: 61.3300 },
            { date: new Date('2017-02-22T10:25:00.000Z'), c: 61.9306, o: 62.0946, h: 62.0946, l: 61.6667 },
            { date: new Date('2017-02-22T10:26:00.000Z'), c: 62.0946, o: 61.7310, h: 62.4999, l: 61.4703 },
            { date: new Date('2017-02-22T10:27:00.000Z'), c: 61.7310, o: 62.0812, h: 62.1000, l: 61.3483 },
            { date: new Date('2017-02-22T10:28:00.000Z'), c: 62.0812, o: 60.6029, h: 62.0812, l: 60.6029 },
            { date: new Date('2017-02-22T10:29:00.000Z'), c: 60.6029, o: 61.0442, h: 61.3088, l: 60.4866 },
            { date: new Date('2017-02-22T10:30:00.000Z'), c: 61.0442, o: 62.4933, h: 62.4933, l: 60.7425 },
        ];

        var sampleData2 = [
            {"date": new Date("2017-02-22T02:39:00Z"),"o":1.05497,"c":1.05487,"h":1.05497,"l":1.05487},
            {"date": new Date("2017-02-22T02:38:00Z"),"o":1.05506,"c":1.05495,"h":1.05506,"l":1.05495},
            {"date": new Date("2017-02-22T02:37:00Z"),"o":1.05509,"c":1.05504,"h":1.0551,"l":1.055},
            {"date": new Date("2017-02-22T02:36:00Z"),"o":1.0551,"c":1.05512,"h":1.05513,"l":1.0551},{"date": new Date("2017-02-22T02:35:00Z"),"o":1.05517,"c":1.05511,"h":1.05517,"l":1.0551},{"date": new Date("2017-02-22T02:34:00Z"),"o":1.05524,"c":1.05515,"h":1.05524,"l":1.05512},{"date": new Date("2017-02-22T02:33:00Z"),"o":1.05532,"c":1.05527,"h":1.05532,"l":1.05527},{"date": new Date("2017-02-22T02:32:00Z"),"o":1.05525,"c":1.05528,"h":1.05532,"l":1.05524},{"date": new Date("2017-02-22T02:31:00Z"),"o":1.05526,"c":1.05523,"h":1.05526,"l":1.05522},{"date": new Date("2017-02-22T02:30:00Z"),"o":1.05527,"c":1.05527,"h":1.05527,"l":1.05522},{"date": new Date("2017-02-22T02:29:00Z"),"o":1.05527,"c":1.05526,"h":1.05527,"l":1.05522},{"date": new Date("2017-02-22T02:28:00Z"),"o":1.05523,"c":1.05526,"h":1.05526,"l":1.05522},{"date": new Date("2017-02-22T02:27:00Z"),"o":1.05512,"c":1.05522,"h":1.05522,"l":1.05506},{"date": new Date("2017-02-22T02:26:00Z"),"o":1.05503,"c":1.05511,"h":1.05512,"l":1.05503},{"date": new Date("2017-02-22T02:25:00Z"),"o":1.05496,"c":1.05504,"h":1.05504,"l":1.05496},{"date": new Date("2017-02-22T02:24:00Z"),"o":1.055,"c":1.05487,"h":1.055,"l":1.05481},{"date": new Date("2017-02-22T02:23:00Z"),"o":1.05491,"c":1.05497,"h":1.05497,"l":1.0549},{"date": new Date("2017-02-22T02:22:00Z"),"o":1.05496,"c":1.05493,"h":1.05501,"l":1.05492},{"date": new Date("2017-02-22T02:21:00Z"),"o":1.05512,"c":1.05494,"h":1.05512,"l":1.05492},{"date": new Date("2017-02-22T02:20:00Z"),"o":1.0549,"c":1.05507,"h":1.05507,"l":1.0549},{"date": new Date("2017-02-22T02:19:00Z"),"o":1.05476,"c":1.05493,"h":1.05493,"l":1.05476},{"date": new Date("2017-02-22T02:18:00Z"),"o":1.0549,"c":1.05475,"h":1.05491,"l":1.05475},{"date": new Date("2017-02-22T02:17:00Z"),"o":1.0549,"c":1.05489,"h":1.05491,"l":1.05489},{"date": new Date("2017-02-22T02:16:00Z"),"o":1.05487,"c":1.05492,"h":1.05492,"l":1.05487},{"date": new Date("2017-02-22T02:15:00Z"),"o":1.05487,"c":1.05483,"h":1.05487,"l":1.05483},{"date": new Date("2017-02-22T02:14:00Z"),"o":1.0548,"c":1.05486,"h":1.05487,"l":1.0548},{"date": new Date("2017-02-22T02:13:00Z"),"o":1.05472,"c":1.05481,"h":1.05483,"l":1.05472},{"date": new Date("2017-02-22T02:12:00Z"),"o":1.05483,"c":1.05473,"h":1.05485,"l":1.05472},{"date": new Date("2017-02-22T02:11:00Z"),"o":1.05465,"c":1.05476,"h":1.05476,"l":1.05465},{"date": new Date("2017-02-22T02:10:00Z"),"o":1.05476,"c":1.05474,"h":1.05477,"l":1.05474},{"date": new Date("2017-02-22T02:09:00Z"),"o":1.05473,"c":1.05475,"h":1.05475,"l":1.05468},{"date": new Date("2017-02-22T02:08:00Z"),"o":1.05473,"c":1.05474,"h":1.05481,"l":1.05472},{"date": new Date("2017-02-22T02:07:00Z"),"o":1.05471,"c":1.05472,"h":1.05473,"l":1.05468},{"date": new Date("2017-02-22T02:06:00Z"),"o":1.05485,"c":1.05469,"h":1.05487,"l":1.05465},{"date": new Date("2017-02-22T02:05:00Z"),"o":1.05475,"c":1.05486,"h":1.05491,"l":1.05475},{"date": new Date("2017-02-22T02:04:00Z"),"o":1.05485,"c":1.05474,"h":1.05489,"l":1.05474},{"date": new Date("2017-02-22T02:03:00Z"),"o":1.05497,"c":1.05484,"h":1.05497,"l":1.05484},{"date": new Date("2017-02-22T02:02:00Z"),"o":1.05495,"c":1.05492,"h":1.05495,"l":1.05488},{"date": new Date("2017-02-22T02:01:00Z"),"o":1.05503,"c":1.055,"h":1.05504,"l":1.05496},{"date": new Date("2017-02-22T02:00:00Z"),"o":1.05496,"c":1.05504,"h":1.05504,"l":1.05493},{"date": new Date("2017-02-22T01:59:00Z"),"o":1.05516,"c":1.05504,"h":1.05517,"l":1.05504},{"date": new Date("2017-02-22T01:58:00Z"),"o":1.0553,"c":1.05524,"h":1.05536,"l":1.0552},{"date": new Date("2017-02-22T01:57:00Z"),"o":1.05531,"c":1.05529,"h":1.05537,"l":1.05527},{"date": new Date("2017-02-22T01:56:00Z"),"o":1.05533,"c":1.05527,"h":1.05534,"l":1.05524},{"date": new Date("2017-02-22T01:55:00Z"),"o":1.05541,"c":1.05535,"h":1.05541,"l":1.05532},{"date": new Date("2017-02-22T01:54:00Z"),"o":1.05547,"c":1.05544,"h":1.05547,"l":1.05541},{"date": new Date("2017-02-22T01:53:00Z"),"o":1.05545,"c":1.05546,"h":1.05554,"l":1.05543},{"date": new Date("2017-02-22T01:52:00Z"),"o":1.05554,"c":1.05544,"h":1.05555,"l":1.05544},{"date": new Date("2017-02-22T01:51:00Z"),"o":1.05527,"c":1.05557,"h":1.05557,"l":1.05527},{"date": new Date("2017-02-22T01:50:00Z"),"o":1.05517,"c":1.05521,"h":1.05521,"l":1.05514},{"date": new Date("2017-02-22T01:49:00Z"),"o":1.05517,"c":1.05516,"h":1.05517,"l":1.0551},{"date": new Date("2017-02-22T01:48:00Z"),"o":1.05511,"c":1.05518,"h":1.0552,"l":1.05511},{"date": new Date("2017-02-22T01:47:00Z"),"o":1.05517,"c":1.05516,"h":1.05519,"l":1.05514},{"date": new Date("2017-02-22T01:46:00Z"),"o":1.05512,"c":1.05516,"h":1.05517,"l":1.05511},{"date": new Date("2017-02-22T01:45:00Z"),"o":1.05508,"c":1.05513,"h":1.05515,"l":1.05507},{"date": new Date("2017-02-22T01:44:00Z"),"o":1.05521,"c":1.05505,"h":1.05521,"l":1.05505},{"date": new Date("2017-02-22T01:43:00Z"),"o":1.05504,"c":1.05525,"h":1.05534,"l":1.05502},{"date": new Date("2017-02-22T01:42:00Z"),"o":1.05494,"c":1.05501,"h":1.05503,"l":1.05491},{"date": new Date("2017-02-22T01:41:00Z"),"o":1.05491,"c":1.05495,"h":1.05496,"l":1.0549},{"date": new Date("2017-02-22T01:40:00Z"),"o":1.05485,"c":1.0549,"h":1.0549,"l":1.05484},{"date": new Date("2017-02-22T01:39:00Z"),"o":1.05486,"c":1.05484,"h":1.05489,"l":1.05484},{"date": new Date("2017-02-22T01:38:00Z"),"o":1.05487,"c":1.05485,"h":1.05487,"l":1.05471},{"date": new Date("2017-02-22T01:37:00Z"),"o":1.05472,"c":1.05485,"h":1.05488,"l":1.05471},{"date": new Date("2017-02-22T01:36:00Z"),"o":1.05482,"c":1.05471,"h":1.05482,"l":1.05471},{"date": new Date("2017-02-22T01:35:00Z"),"o":1.0547,"c":1.05476,"h":1.05477,"l":1.05469},{"date": new Date("2017-02-22T01:34:00Z"),"o":1.05476,"c":1.05469,"h":1.05478,"l":1.05469},{"date": new Date("2017-02-22T01:33:00Z"),"o":1.05479,"c":1.05477,"h":1.05483,"l":1.05476},{"date": new Date("2017-02-22T01:32:00Z"),"o":1.0547,"c":1.05478,"h":1.05479,"l":1.0547},{"date": new Date("2017-02-22T01:31:00Z"),"o":1.05479,"c":1.05473,"h":1.05482,"l":1.0547},{"date": new Date("2017-02-22T01:30:00Z"),"o":1.05466,"c":1.05476,"h":1.05476,"l":1.05466},{"date": new Date("2017-02-22T01:29:00Z"),"o":1.05471,"c":1.05464,"h":1.05473,"l":1.05464},{"date": new Date("2017-02-22T01:28:00Z"),"o":1.05491,"c":1.05472,"h":1.05491,"l":1.05472},{"date": new Date("2017-02-22T01:27:00Z"),"o":1.05482,"c":1.0549,"h":1.0549,"l":1.05482},{"date": new Date("2017-02-22T01:26:00Z"),"o":1.05478,"c":1.0548,"h":1.05482,"l":1.05477},{"date": new Date("2017-02-22T01:25:00Z"),"o":1.05477,"c":1.05474,"h":1.05477,"l":1.05473},{"date": new Date("2017-02-22T01:24:00Z"),"o":1.05476,"c":1.05475,"h":1.05479,"l":1.05471},{"date": new Date("2017-02-22T01:23:00Z"),"o":1.05471,"c":1.05475,"h":1.05477,"l":1.05471},{"date": new Date("2017-02-22T01:22:00Z"),"o":1.05476,"c":1.05472,"h":1.05476,"l":1.05468},{"date": new Date("2017-02-22T01:21:00Z"),"o":1.0547,"c":1.05475,"h":1.05476,"l":1.0547},{"date": new Date("2017-02-22T01:20:00Z"),"o":1.05462,"c":1.05472,"h":1.05475,"l":1.05456},{"date": new Date("2017-02-22T01:19:00Z"),"o":1.05471,"c":1.05461,"h":1.05473,"l":1.05461},{"date": new Date("2017-02-22T01:18:00Z"),"o":1.05473,"c":1.05472,"h":1.05473,"l":1.05465},{"date": new Date("2017-02-22T01:17:00Z"),"o":1.05478,"c":1.0547,"h":1.05482,"l":1.0547},{"date": new Date("2017-02-22T01:16:00Z"),"o":1.05481,"c":1.05476,"h":1.05488,"l":1.05476},{"date": new Date("2017-02-22T01:15:00Z"),"o":1.05474,"c":1.0548,"h":1.05483,"l":1.05474},{"date": new Date("2017-02-22T01:14:00Z"),"o":1.05484,"c":1.05475,"h":1.05492,"l":1.05475},{"date": new Date("2017-02-22T01:13:00Z"),"o":1.05474,"c":1.05486,"h":1.05493,"l":1.05471},{"date": new Date("2017-02-22T01:12:00Z"),"o":1.05469,"c":1.05475,"h":1.05477,"l":1.05467},{"date": new Date("2017-02-22T01:11:00Z"),"o":1.05481,"c":1.05472,"h":1.05481,"l":1.0547},{"date": new Date("2017-02-22T01:10:00Z"),"o":1.05476,"c":1.05485,"h":1.05486,"l":1.05471},{"date": new Date("2017-02-22T01:09:00Z"),"o":1.05485,"c":1.05475,"h":1.05485,"l":1.0547},{"date": new Date("2017-02-22T01:08:00Z"),"o":1.0547,"c":1.05488,"h":1.05488,"l":1.05469},{"date": new Date("2017-02-22T01:07:00Z"),"o":1.05466,"c":1.05468,"h":1.05472,"l":1.05462},{"date": new Date("2017-02-22T01:06:00Z"),"o":1.05484,"c":1.0547,"h":1.05492,"l":1.0547},{"date": new Date("2017-02-22T01:05:00Z"),"o":1.05492,"c":1.0548,"h":1.05495,"l":1.05479},{"date": new Date("2017-02-22T01:04:00Z"),"o":1.05472,"c":1.05489,"h":1.05491,"l":1.05471},{"date": new Date("2017-02-22T01:03:00Z"),"o":1.05461,"c":1.05461,"h":1.05461,"l":1.05454},{"date": new Date("2017-02-22T01:02:00Z"),"o":1.05461,"c":1.05465,"h":1.05466,"l":1.05461},{"date": new Date("2017-02-22T01:01:00Z"),"o":1.05451,"c":1.05463,"h":1.05463,"l":1.0545},{"date": new Date("2017-02-22T01:00:00Z"),"o":1.05435,"c":1.05452,"h":1.05452,"l":1.05435},{"date": new Date("2017-02-22T00:59:00Z"),"o":1.05434,"c":1.05436,"h":1.05436,"l":1.05434},{"date": new Date("2017-02-22T00:58:00Z"),"o":1.05443,"c":1.05435,"h":1.05444,"l":1.05435},{"date": new Date("2017-02-22T00:57:00Z"),"o":1.05432,"c":1.05433,"h":1.05433,"l":1.0543},{"date": new Date("2017-02-22T00:56:00Z"),"o":1.05423,"c":1.05425,"h":1.05427,"l":1.05414},{"date": new Date("2017-02-22T00:55:00Z"),"o":1.05435,"c":1.05422,"h":1.05435,"l":1.05422},{"date": new Date("2017-02-22T00:54:00Z"),"o":1.05417,"c":1.05434,"h":1.05434,"l":1.05417},{"date": new Date("2017-02-22T00:53:00Z"),"o":1.05415,"c":1.05416,"h":1.05423,"l":1.05414},{"date": new Date("2017-02-22T00:52:00Z"),"o":1.05418,"c":1.05412,"h":1.05418,"l":1.05411},{"date": new Date("2017-02-22T00:51:00Z"),"o":1.0543,"c":1.05426,"h":1.0543,"l":1.05421},{"date": new Date("2017-02-22T00:50:00Z"),"o":1.05434,"c":1.05431,"h":1.05434,"l":1.05431},{"date": new Date("2017-02-22T00:49:00Z"),"o":1.0544,"c":1.05435,"h":1.0544,"l":1.05432},{"date": new Date("2017-02-22T00:48:00Z"),"o":1.05442,"c":1.05439,"h":1.05442,"l":1.05436},{"date": new Date("2017-02-22T00:47:00Z"),"o":1.05433,"c":1.05437,"h":1.05437,"l":1.05429},{"date": new Date("2017-02-22T00:46:00Z"),"o":1.05427,"c":1.05431,"h":1.05431,"l":1.05426},{"date": new Date("2017-02-22T00:45:00Z"),"o":1.05424,"c":1.05426,"h":1.05436,"l":1.05424},{"date": new Date("2017-02-22T00:44:00Z"),"o":1.05431,"c":1.05426,"h":1.05431,"l":1.05416},{"date": new Date("2017-02-22T00:43:00Z"),"o":1.05437,"c":1.05424,"h":1.05437,"l":1.05424},{"date": new Date("2017-02-22T00:42:00Z"),"o":1.05442,"c":1.05441,"h":1.05444,"l":1.05437},{"date": new Date("2017-02-22T00:41:00Z"),"o":1.05435,"c":1.05439,"h":1.05444,"l":1.05435},{"date": new Date("2017-02-22T00:40:00Z"),"o":1.0544,"c":1.05434,"h":1.0544,"l":1.05431},{"date": new Date("2017-02-22T00:39:00Z"),"o":1.05435,"c":1.05446,"h":1.05447,"l":1.05431},{"date": new Date("2017-02-22T00:38:00Z"),"o":1.05449,"c":1.05436,"h":1.05449,"l":1.05436},{"date": new Date("2017-02-22T00:37:00Z"),"o":1.05465,"c":1.0545,"h":1.05465,"l":1.05449},{"date": new Date("2017-02-22T00:36:00Z"),"o":1.05455,"c":1.05469,"h":1.05469,"l":1.05451},{"date": new Date("2017-02-22T00:35:00Z"),"o":1.05457,"c":1.05456,"h":1.0546,"l":1.05451},{"date": new Date("2017-02-22T00:34:00Z"),"o":1.05462,"c":1.05461,"h":1.05468,"l":1.05454},{"date": new Date("2017-02-22T00:33:00Z"),"o":1.05457,"c":1.05453,"h":1.05458,"l":1.05451},{"date": new Date("2017-02-22T00:32:00Z"),"o":1.05451,"c":1.05452,"h":1.05452,"l":1.0545},{"date": new Date("2017-02-22T00:31:00Z"),"o":1.0546,"c":1.05452,"h":1.05468,"l":1.05447},{"date": new Date("2017-02-22T00:30:00Z"),"o":1.05461,"c":1.05456,"h":1.05463,"l":1.05447},{"date": new Date("2017-02-22T00:29:00Z"),"o":1.05464,"c":1.05465,"h":1.05465,"l":1.05461},{"date": new Date("2017-02-22T00:28:00Z"),"o":1.05462,"c":1.0546,"h":1.05463,"l":1.0546},{"date": new Date("2017-02-22T00:27:00Z"),"o":1.05461,"c":1.05465,"h":1.05465,"l":1.0546},{"date": new Date("2017-02-22T00:26:00Z"),"o":1.05469,"c":1.05462,"h":1.05469,"l":1.05459},{"date": new Date("2017-02-22T00:25:00Z"),"o":1.05462,"c":1.05477,"h":1.05477,"l":1.05461},{"date": new Date("2017-02-22T00:24:00Z"),"o":1.05482,"c":1.05465,"h":1.05482,"l":1.05461},{"date": new Date("2017-02-22T00:23:00Z"),"o":1.05475,"c":1.05484,"h":1.05486,"l":1.05475},{"date": new Date("2017-02-22T00:22:00Z"),"o":1.05466,"c":1.05474,"h":1.05474,"l":1.05465},{"date": new Date("2017-02-22T00:21:00Z"),"o":1.05484,"c":1.05465,"h":1.05484,"l":1.05462},{"date": new Date("2017-02-22T00:20:00Z"),"o":1.05466,"c":1.05482,"h":1.05484,"l":1.05466},{"date": new Date("2017-02-22T00:19:00Z"),"o":1.05491,"c":1.0547,"h":1.05491,"l":1.05463},{"date": new Date("2017-02-22T00:18:00Z"),"o":1.05468,"c":1.05492,"h":1.05493,"l":1.05466},{"date": new Date("2017-02-22T00:17:00Z"),"o":1.05476,"c":1.05481,"h":1.05491,"l":1.05476},{"date": new Date("2017-02-22T00:16:00Z"),"o":1.05485,"c":1.0547,"h":1.05486,"l":1.05467},{"date": new Date("2017-02-22T00:15:00Z"),"o":1.05464,"c":1.05488,"h":1.05488,"l":1.05464},{"date": new Date("2017-02-22T00:14:00Z"),"o":1.05462,"c":1.0547,"h":1.0547,"l":1.05462},{"date": new Date("2017-02-22T00:13:00Z"),"o":1.05458,"c":1.05473,"h":1.05473,"l":1.05456},{"date": new Date("2017-02-22T00:12:00Z"),"o":1.05453,"c":1.05457,"h":1.05459,"l":1.05453},{"date": new Date("2017-02-22T00:11:00Z"),"o":1.05445,"c":1.05454,"h":1.05457,"l":1.05444},{"date": new Date("2017-02-22T00:10:00Z"),"o":1.05424,"c":1.05443,"h":1.05446,"l":1.05424},{"date": new Date("2017-02-22T00:09:00Z"),"o":1.0542,"c":1.05422,"h":1.05425,"l":1.05418},{"date": new Date("2017-02-22T00:08:00Z"),"o":1.05434,"c":1.05419,"h":1.05435,"l":1.05418},{"date": new Date("2017-02-22T00:07:00Z"),"o":1.05418,"c":1.05436,"h":1.05436,"l":1.05417},{"date": new Date("2017-02-22T00:06:00Z"),"o":1.05417,"c":1.05419,"h":1.05433,"l":1.05417},{"date": new Date("2017-02-22T00:05:00Z"),"o":1.05413,"c":1.05416,"h":1.05416,"l":1.05413},{"date": new Date("2017-02-22T00:03:00Z"),"o":1.05411,"c":1.05414,"h":1.05419,"l":1.05407},
        {"date": new Date("2017-02-22T00:02:00Z"),"o":1.05416,"c":1.05414,"h":1.05417,"l":1.05414},
        {"date": new Date("2017-02-22T00:01:00Z"),"o":1.05425,"c":1.05415,"h":1.05425,"l":1.05411},
        {"date": new Date("2017-02-22T00:00:00Z"),"o":1.05422,"c":1.05417,"h":1.05443,"l":1.05417}];
    </script>

    <script type="text/javascript">
        let urls = {
            // assets: 'http://localhost:57811/api/AssetPairs/dictionary',
            // candles: 'http://localhost:57811/api/Candles/history/'
            assets: 'http://localhost:57811/api/AssetPairs/dictionary',
            candles: 'http://localhost:2226/api/stub/'            
        };
    </script>

    <script type="text/javascript">
        
        function intervalToPeriod(interval) {
            switch (interval) {
                case lychart.core.TimeInterval.sec: return 'Sec';
                case lychart.core.TimeInterval.min: return 'Minute';
                case lychart.core.TimeInterval.hour: return 'Hour';
                case lychart.core.TimeInterval.day: return 'Day';
                case lychart.core.TimeInterval.month: return 'Month';
            }
        }

        function periodToInterval(period) {
            switch (period) {
                case 'Sec': return lychart.core.TimeInterval.sec;
                case 'Minute': return lychart.core.TimeInterval.min;
                case 'Hour': return lychart.core.TimeInterval.hour;
                case 'Day': return lychart.core.TimeInterval.day;
                case 'Month': return lychart.core.TimeInterval.month;
            }
        }

        let chart = (function() { 

            var
                board = null,
                url = '',
                uid = '1',
                dataSource = null,

                readData = function (timeStart, timeEnd, interval) {
                    $.support.cors = true;

                    let settings = {
                        method: 'POST',
                        crossDomain: true,
                        dataType: 'json',
                        url: url,
                        contentType: "application/json",
                        data: JSON.stringify({
                            period: intervalToPeriod(interval),
                            type: 'Bid',
                            dateFrom: timeStart.toISOString(),
                            dateTo: timeEnd.toISOString()
                        })
                    };
                    return $.ajax(settings);
                },

                resolveData = function(response) {
                    if (response) {
                        const data = response.data
                            .map(function(item) {
                                return new lychart.model.Candlestick(new Date(item.t), item.c, item.o, item.h, item.l);;
                            });

                        return {
                            startDateTime: response.dateFrom,
                            endDateTime: response.dateTo,
                            interval: periodToInterval(response.period),
                            data: data
                        };
                    }
                },

                init = function($containerEl, w, h, border, timeInterval) {
                    board = new lychart.ChartBoard($containerEl, border, border, w, h, timeInterval);
                },

                setChart = function(assetPairId, timeInterval) {

                    url = urls.candles + assetPairId;

                    if (dataSource) {
                        console.debug('removing chart = ' + uid)
                        board.removeChart(uid);
                        dataSource.dispose();
                    }

                    // recreate data source
                    dataSource = new lychart.data.HttpDataSource(
                        lychart.model.Candlestick,
                        {
                            autoupdate: true,
                            readData: readData,
                            resolveData: resolveData,
                            timeInterval: timeInterval
                        });

                    board.setTimeInterval(timeInterval);
                    board.addChart(uid, 
                                   (timeInterval === lychart.core.TimeInterval.sec) ? lychart.core.ChartType.line : lychart.core.ChartType.candle, 
                                   dataSource);
                },

                render = function() {
                    board.render();
                },

                resize = function(w, h) {
                    board.resize(w, h);
                    board.render();
                };

            return {
                init: init,
                setChart: setChart,
                render: render,
                resize: resize
            };
        })();
    </script>

    <script type="text/javascript">
        $(function() {
            function loadAssets() {
                console.debug('loading assets list');
                $.support.cors = true; // Otherwise "no transport" in IE 11.
                return $.ajax({
                    method: 'GET',
                    dataType: 'json',
                    url: urls.assets,
                    contentType: "application/json"
                });
            }

            function getSelectedTimeInterval() {
                let timeinterval = $("#timeinterval option:selected").val();
                return lychart.core.TimeInterval[timeinterval]
            }

            function getSelectedAssetPair() {
                let assetPair = $("#assetpair option:selected").val();
                return assetPair;
            }

            function initForm(assets) {
                var defaultPair = "BTCUSD";

                // init <select>
                $.each(assets, function(i, item) {
                    $('#assetpair').append($('<option></option>').val(item.id).html(item.name));
                });
                $("#assetpair").val(defaultPair); // select default value
                $('#assetpair').change(function(){
                    updateChart();
                });

                $('#timeinterval').change(function(){
                    updateChart();        
                });

                updateChart();
            }

            function updateChart() {
                chart.setChart(getSelectedAssetPair(), getSelectedTimeInterval());
                chart.render();
            }

            let border = 25;
            let minChartWidth = 100;
            let minChartHeight = 100;

            let w = Math.max(window.innerWidth - border * 2, minChartWidth);
            let h = Math.max(window.innerHeight - border * 2, minChartHeight);   

            chart.init($("#chart-container")[0], w, h, border);

            window.onresize = function(event) {
                let w = Math.max(window.innerWidth - border * 2, minChartWidth);
                let h = Math.max(window.innerHeight - border * 2, minChartHeight);
                chart.resize(w, h);
            };

            loadAssets()
                .then(function(assets) {
                    initForm(assets);
                })
                .fail(function(jqXhr, textStatus, errorThrown) {
                    console.debug('Request failed:' + textStatus + ' ' + errorThrown);
                });
        });
    </script>    
</body>
</html>
